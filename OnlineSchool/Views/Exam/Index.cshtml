@model OnlineSchool.Models.ExamModel
@{
    ViewData["Title"] = "Exam";
}
<div class="container">
    <div>
        <h2>@Model.CourseCode | @Model.CourseTitle </h2>
        <h3>@Model.Title</h3>
    </div>
    <div class="row">
        <div class="col-md-3">
            <partial name="_QuestionsTab" model="Model" />
            <div class="mt-4 text-center"><span id="time" style="padding: 15px; border: 3px solid black; border-radius: 44px; font-size: 18px;">00:00</span></div>
            <div class="text-center">
                <a onclick="FinishAttempt(@Model.AttemptId)" class="mt-4 btn btn-sm btn-custom-primary text-center text-white" href="#">Finish attempt</a>
            </div>
        </div>
        <div class="col-md-9">
            <div id="questions-list-id">
                <partial name="_QuestionsList" model="Model" />
            </div>
        </div>
    </div>
</div>
<script>

    function FinishAttempt(attemptId) {
        if (confirm("Are you sure you want to submit this attempt?")) {
            location.href = "/exam/attemptFinished/" + attemptId;
        }
    }

    function MoveToPage(attemptId, pageNumber, pageScrollId) {
        $.ajax({
            url: "/exam/movetopage",
            data: { pageNumber: pageNumber, attemptId: attemptId },
            success: function (result) {
                document.getElementById("questions-list-id").innerHTML = result;
                if (pageScrollId != "") {
                    $('html, body').animate({
                        scrollTop: $("#"+pageScrollId).offset().top
                    }, 'slow');
                }
            }
        })
    }

    function SubmitMcqAnswer(attemptId, answerId, questionNumber, mcqId) {
        $.ajax({
            url: "/exam/SubmitMcqAnswer",
            data: { mcqAttemptId: attemptId, answerId: answerId },
            success: function (result) {
                var questionTabId = "question-tab-" + mcqId + "-" + questionNumber;
                var questionTab = document.getElementById(questionTabId);
                questionTab.classList.remove("unanswered-question");
                questionTab.classList.add("answered-question");
            }
        })
    }

    function SubmitTheoryAnswer(attemptId, answerId, questionNumber, mcqId) {
        var answer = document.getElementById(answerId).value;
        $.ajax({
            url: "/exam/SubmitTheoryAnswer",
            data: { theoryAttemptId: attemptId, answer: answer },
            success: function (result) {
                var questionTabId = "question-tab-" + mcqId + "-" + questionNumber;
                var questionTab = document.getElementById(questionTabId);
                questionTab.classList.remove("unanswered-question");
                questionTab.classList.add("answered-question");
            }
        })
    }

    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        //debugger;
        setInterval(function () {
            UpdateTime(timer);
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                window.location.href = "/exam/AttemptFinished/" + document.getElementById("AttemptId").value;
            }

        }, 1000);
    }

    window.onload = function () {
        var durationInSeconds = document.getElementById("DurationInSeconds").value;
        display = document.querySelector('#time');
        startTimer(durationInSeconds, display);
    };


    function UpdateTime(durationRemaining) {
        //debugger;
        var attemptid = document.getElementById("AttemptId").value;
        $.ajax({
            url: "/exam/UpdateDuration",
            data: { examAttemptId: attemptid, durationLeft: durationRemaining },
            success: function (result) {
            }
        })
    }

</script>